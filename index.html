<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Poker Coach</title>
  <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="/manifest.webmanifest">
  <meta name="theme-color" content="#0b0b0b">
  <link rel="apple-touch-icon" href="/icon-192.png">
  <script type="module" crossorigin src="/assets/index-DFygKoBP.js"></script>
</head>
<body>
  <h1>Poker Coach</h1>

  <div class="input">
    <label>Jouw hand:</label>
    <input id="hand" placeholder="Bijv. AhKh (h = hearts)" />
  </div>

  <div class="input">
    <label>Board (optioneel):</label>
    <input id="board" placeholder="Bijv. QhJh9d" />
  </div>

  <div class="input">
    <label>Pot (â‚¬):</label>
    <input id="pot" type="number" value="10" />
  </div>

  <div class="input">
    <label>Bet van tegenstander (â‚¬):</label>
    <input id="bet" type="number" value="5" />
  </div>
  
<div class="input">
  <label>Tegenstander type (range):</label>
  <select id="villainType">
    <option value="tight">Tight</option>
    <option value="average" selected>Average</option>
    <option value="loose">Loose</option>
  </select>
</div>

<div class="input">
  <label>Aantal tegenstanders:</label>
  <input id="numOpp" type="number" value="1" min="1" max="6" />
</div>
<div class="input">
  <label>Jouw positie (preflop):</label>
  <select id="heroPos">
    <option>UTG</option>
    <option>HJ</option>
    <option>CO</option>
    <option selected>BTN</option>
    <option>SB</option>
    <option>BB</option>
  </select>
</div>
<div class="input">
  <label>Simulatiesnelheid:</label>
  <select id="simSpeed">
    <option value="5000">Snel (5k)</option>
    <option value="20000" selected>Normaal (20k)</option>
    <option value="50000">Nauwkeurig (50k)</option>
  </select>
</div>

<div class="input">
  <label>Villain positie (preflop):</label>
  <select id="villainPos">
    <option>UTG</option>
    <option>HJ</option>
    <option>CO</option>
    <option>BTN</option>
    <option selected>SB</option>
    <option>BB</option>
  </select>
</div>

<div class="input">
  <label>Situatie:</label>
  <select id="spot">
    <option value="first_in" selected>First-in (open)</option>
    <option value="vs_open">Vs open raise</option>
    <option value="vs_3bet">Vs 3-bet</option>
  </select>
</div>

<div class="input">
  <label>Postflop: ik ben in positie (IP)</label>
  <input id="ipFlag" type="checkbox" checked />
</div>

<hr>
<h2>ðŸ“· Scanner</h2>
  <!-- === Pokerhand Scanner (drop-in vervanger) === -->
<section id="poker-scanner" style="text-align:center; padding:20px;">
  <h2 style="margin-bottom:10px;">Pokerhand Scanner</h2>

  <!-- Camera preview -->
  <video id="cameraStream" autoplay playsinline muted
         width="320" height="240"
         style="border:1px solid #333; border-radius:8px; background:#000;"></video>

  <!-- (optioneel) canvas voor snapshots/verwerking, blijft verborgen -->
  <canvas id="scannerCanvas" width="320" height="240" style="display:none;"></canvas>

  <!-- Actieknoppen -->
  <div style="margin-top:12px; display:flex; gap:10px; justify-content:center; flex-wrap:wrap;">
    <button id="calibrateBtn">Kalibreren</button>
    <button id="resultBtn">Scanresultaat</button>
  </div>

  <!-- Status + resultaat -->
  <p id="scannerStatus" style="margin-top:10px; color:#666;">Camera initialiserenâ€¦</p>
  <div id="scanResult"
       style="margin-top:8px; font-family:system-ui,Arial; font-size:14px; text-align:left; display:inline-block; max-width:320px;"></div>

  <script>
    (function () {
      // Elementen
      const video   = document.getElementById('cameraStream');
      const canvas  = document.getElementById('scannerCanvas');
      const status  = document.getElementById('scannerStatus');
      const out     = document.getElementById('scanResult');
      const btnCal  = document.getElementById('calibrateBtn');
      const btnRes  = document.getElementById('resultBtn');

      // Interne state
      let stream = null;
      let calibration = loadCalibration();

      // ---- Camera starten (behoudt huidige werking) ----
      async function startCamera() {
        // Als er al een stream is, niets forceren (laat huidige werking intact)
        if (video.srcObject && video.srcObject.active) {
          stream = video.srcObject;
          status.textContent = 'Camera actief.';
          return;
        }

        try {
          // Probeer achtercamera op mobiel, fallback naar default
          const constraints = {
            video: { facingMode: { ideal: 'environment' }, width: { ideal: 1280 }, height: { ideal: 720 } },
            audio: false
          };
          stream = await navigator.mediaDevices.getUserMedia(constraints);
          video.srcObject = stream;
          status.textContent = 'Camera actief en klaar voor gebruik.';
        } catch (err) {
          status.textContent = 'Camera niet beschikbaar: ' + err.message;
        }
      }

      // ---- Kalibreren ----
      // Slaat simpele baseline-waarden op (gemiddelde helderheid/contrast) om later bij het scannen te gebruiken.
      function calibrate() {
        if (!videoReady()) {
          status.textContent = 'Wacht tot de camera actief isâ€¦';
          return;
        }
        const metrics = snapshotMetrics();
        calibration = {
          mean: metrics.mean,
          variance: metrics.variance,
          ts: Date.now()
        };
        saveCalibration(calibration);
        status.textContent = 'Kalibratie voltooid âœ… (mean=' + calibration.mean.toFixed(1) + ')';
      }

      // ---- Scanresultaat ----
      // Neemt een frame en vergelijkt het grofweg met de kalibratie; hier kun je later jouw echte logica aan koppelen.
      function showResult() {
        if (!videoReady()) {
          status.textContent = 'Wacht tot de camera actief isâ€¦';
          return;
        }
        const metrics = snapshotMetrics();

        // Eenvoudige vergelijkingsscore
        let scoreText = 'Geen kalibratie gevonden. Tip: eerst Kalibreren.';
        if (calibration) {
          const delta = Math.abs(metrics.mean - calibration.mean);
          const noise = Math.abs(metrics.variance - calibration.variance);
          scoreText = `Î” helderheid: ${delta.toFixed(1)}, Î” ruis: ${noise.toFixed(1)}`;
        }

        out.innerHTML = `
          <div style="padding:10px; border:1px solid #e3e3e3; border-radius:8px;">
            <div style="font-weight:600; margin-bottom:6px;">Scanresultaat</div>
            <div><strong>Gem. helderheid:</strong> ${metrics.mean.toFixed(1)}</div>
            <div><strong>Variantie (ruis):</strong> ${metrics.variance.toFixed(1)}</div>
            <div style="margin-top:6px;"><strong>Vergelijking t.o.v. kalibratie:</strong> ${scoreText}</div>
          </div>
        `;
        status.textContent = 'Scan voltooid âœ…';
      }

      // ---- Helpers ----
      function videoReady() {
        return video && video.readyState >= 2 && video.videoWidth > 0;
      }

      // Neemt snapshot, berekent simpele stats (mean en variance van grijswaarden)
      function snapshotMetrics() {
        const w = video.videoWidth || canvas.width;
        const h = video.videoHeight || canvas.height;
        if (canvas.width !== w) canvas.width = w;
        if (canvas.height !== h) canvas.height = h;

        const ctx = canvas.getContext('2d', { willReadFrequently: true });
        ctx.drawImage(video, 0, 0, w, h);
        const { data } = ctx.getImageData(0, 0, w, h);

        let sum = 0, sumSq = 0, n = data.length / 4;
        for (let i = 0; i < data.length; i += 4) {
          // Luma (BT.709): 0.2126R + 0.7152G + 0.0722B
          const y = 0.2126 * data[i] + 0.7152 * data[i + 1] + 0.0722 * data[i + 2];
          sum += y;
          sumSq += y * y;
        }
        const mean = sum / n;
        const variance = sumSq / n - mean * mean;
        return { mean, variance, w, h };
      }

      function saveCalibration(c) {
        try { localStorage.setItem('pokerScannerCalibration', JSON.stringify(c)); } catch {}
      }
      function loadCalibration() {
        try {
          const raw = localStorage.getItem('pokerScannerCalibration');
          return raw ? JSON.parse(raw) : null;
        } catch { return null; }
      }

      // ---- Events ----
      btnCal.addEventListener('click', calibrate);
      btnRes.addEventListener('click', showResult);
      video.addEventListener('loadeddata', () => { status.textContent = 'Camera actief.'; });

      // Start direct
      startCamera();
    })();
  </script>
</section>
<!-- === /Pokerhand Scanner === -->

