<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Poker Coach</title>
  <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="/manifest.webmanifest">
  <meta name="theme-color" content="#0b0b0b">
  <link rel="apple-touch-icon" href="/icon-192.png">
  <script type="module" crossorigin src="/assets/index-DFygKoBP.js"></script>
</head>
<body>
  <h1>Poker Coach</h1>

  <div class="input">
    <label>Jouw hand:</label>
    <input id="hand" placeholder="Bijv. AhKh (h = hearts)" />
  </div>

  <div class="input">
    <label>Board (optioneel):</label>
    <input id="board" placeholder="Bijv. QhJh9d" />
  </div>

  <div class="input">
    <label>Pot (‚Ç¨):</label>
    <input id="pot" type="number" value="10" />
  </div>

  <div class="input">
    <label>Bet van tegenstander (‚Ç¨):</label>
    <input id="bet" type="number" value="5" />
  </div>
  
<div class="input">
  <label>Tegenstander type (range):</label>
  <select id="villainType">
    <option value="tight">Tight</option>
    <option value="average" selected>Average</option>
    <option value="loose">Loose</option>
  </select>
</div>

<div class="input">
  <label>Aantal tegenstanders:</label>
  <input id="numOpp" type="number" value="1" min="1" max="6" />
</div>
<div class="input">
  <label>Jouw positie (preflop):</label>
  <select id="heroPos">
    <option>UTG</option>
    <option>HJ</option>
    <option>CO</option>
    <option selected>BTN</option>
    <option>SB</option>
    <option>BB</option>
  </select>
</div>
<div class="input">
  <label>Simulatiesnelheid:</label>
  <select id="simSpeed">
    <option value="5000">Snel (5k)</option>
    <option value="20000" selected>Normaal (20k)</option>
    <option value="50000">Nauwkeurig (50k)</option>
  </select>
</div>

<div class="input">
  <label>Villain positie (preflop):</label>
  <select id="villainPos">
    <option>UTG</option>
    <option>HJ</option>
    <option>CO</option>
    <option>BTN</option>
    <option selected>SB</option>
    <option>BB</option>
  </select>
</div>

<div class="input">
  <label>Situatie:</label>
  <select id="spot">
    <option value="first_in" selected>First-in (open)</option>
    <option value="vs_open">Vs open raise</option>
    <option value="vs_3bet">Vs 3-bet</option>
  </select>
</div>

<div class="input">
  <label>Postflop: ik ben in positie (IP)</label>
  <input id="ipFlag" type="checkbox" checked />
</div>

<hr>
<h2>üì∑ Scanner</h2>
<!-- === Pokerhand Scanner (breed, lagere hoogte + grote knoppen) === -->
<section id="poker-scanner" style="padding:20px; text-align:center;">
  <h2 style="margin-bottom:14px;">Pokerhand Scanner</h2>

  <!-- Camera: breed maar niet te hoog -->
  <video id="camera" autoplay playsinline muted
         style="
           width:100%;
           max-width:100%;
           aspect-ratio:16/9;
           height:auto;
           background:#000;
           border:1px solid #222;
           border-radius:12px;
           display:block;
           margin:0 auto;
         ">
  </video>

  <canvas id="scannerCanvas" style="display:none;"></canvas>

  <!-- Grotere knoppen -->
  <div style="margin-top:18px; display:flex; flex-wrap:wrap; gap:14px; justify-content:center;">
    <button id="startBtn" style="padding:12px 26px; font-size:1.1rem;">‚ñ∂ Start camera</button>
    <button id="stopBtn" style="padding:12px 26px; font-size:1.1rem;">‚èπ Stop camera</button>
    <button id="calibrateBtn" style="padding:12px 26px; font-size:1.1rem;">üéØ Kalibreren</button>
    <button id="resultBtn" style="padding:12px 26px; font-size:1.1rem;">üÉè Scanresultaat</button>
    <button id="adviceBtn" style="padding:12px 26px; font-size:1.1rem;">üí° Toon advies</button>
  </div>

  <!-- Status en resultaten -->
  <p id="scannerStatus" style="margin-top:14px; color:#666; font-size:1rem;">Gereed‚Ä¶</p>
  <div id="scanResult" style="margin-top:10px; max-width:800px; text-align:left; margin-inline:auto;"></div>
  <div id="scanAdvice" style="margin-top:14px; font-size:1.1rem; font-style:italic; color:#004085;"></div>

  <script>
    (function () {
      const video  = document.getElementById('camera');
      const canvas = document.getElementById('scannerCanvas');
      const status = document.getElementById('scannerStatus');
      const out    = document.getElementById('scanResult');
      const advice = document.getElementById('scanAdvice');

      const startB = document.getElementById('startBtn');
      const stopB  = document.getElementById('stopBtn');
      const calB   = document.getElementById('calibrateBtn');
      const resB   = document.getElementById('resultBtn');
      const advB   = document.getElementById('adviceBtn');

      let stream = null;
      let calibration = loadCalibration();
      let lastScan = null;

      async function startCamera() {
        try {
          if (video.srcObject && video.srcObject.active) {
            status.textContent = 'Camera is al actief.';
            return;
          }
          const constraints = {
            video: { facingMode: { ideal: 'environment' }, width: { ideal: 1920 }, height: { ideal: 1080 } },
            audio: false
          };
          stream = await navigator.mediaDevices.getUserMedia(constraints);
          video.srcObject = stream;
          status.textContent = 'Camera actief en klaar voor gebruik.';
        } catch (err) {
          status.textContent = 'Camera niet beschikbaar: ' + err.message;
        }
      }

      function stopCamera() {
        if (stream) {
          stream.getTracks().forEach(t => t.stop());
          video.srcObject = null;
          stream = null;
          status.textContent = 'Camera gestopt.';
        }
      }

      function calibrate() {
        if (!videoReady()) {
          status.textContent = 'Start eerst de camera.';
          return;
        }
        const m = snapshotMetrics();
        calibration = { mean: m.mean, variance: m.variance, ts: Date.now() };
        saveCalibration(calibration);
        status.textContent = `Kalibratie voltooid ‚úÖ (mean=${m.mean.toFixed(1)})`;
      }

      function showResult() {
        if (!videoReady()) {
          status.textContent = 'Start eerst de camera.';
          return;
        }
        const m = snapshotMetrics();
        lastScan = m;
        let compare = 'Geen kalibratie gevonden (tip: eerst Kalibreren).';
        if (calibration) {
          const dMean = Math.abs(m.mean - calibration.mean);
          const dVar  = Math.abs(m.variance - calibration.variance);
          compare = `Œî helderheid: ${dMean.toFixed(1)}, Œî ruis: ${dVar.toFixed(1)}`;
        }
        out.innerHTML = `
          <div style="padding:14px; border:1px solid #e5e5e5; border-radius:10px; background:#fafafa;">
            <div style="font-weight:600; margin-bottom:6px;">Scanresultaat</div>
            <div><strong>Gem. helderheid:</strong> ${m.mean.toFixed(1)}</div>
            <div><strong>Variantie (ruis):</strong> ${m.variance.toFixed(1)}</div>
            <div style="margin-top:6px;"><strong>Vergelijking t.o.v. kalibratie:</strong> ${compare}</div>
          </div>
        `;
        status.textContent = 'Scan voltooid ‚úÖ';
      }

      function showAdvice() {
        if (!lastScan) {
          advice.textContent = 'Geen scan beschikbaar. Druk eerst op ‚ÄúScanresultaat‚Äù.';
          return;
        }
        let msg = '';
        if (lastScan.mean > 150) msg = 'Licht beeld ‚Äî probeer schaduw of afstand te corrigeren.';
        else if (lastScan.mean < 80) msg = 'Donker beeld ‚Äî zorg voor meer licht boven de tafel.';
        else msg = 'Beeldkwaliteit is goed. Analyseer nu de kaarten.';
        advice.textContent = 'Advies: ' + msg;
        status.textContent = 'Advies getoond üí°';
      }

      function videoReady() {
        return video && video.readyState >= 2 && (video.videoWidth || 0) > 0;
      }

      function snapshotMetrics() {
        const w = video.videoWidth || 1280;
        const h = video.videoHeight || 720;
        canvas.width = w;
        canvas.height = h;
        const ctx = canvas.getContext('2d', { willReadFrequently: true });
        ctx.drawImage(video, 0, 0, w, h);
        const { data } = ctx.getImageData(0, 0, w, h);
        let sum = 0, sumSq = 0, n = data.length / 4;
        for (let i = 0; i < data.length; i += 4) {
          const y = 0.2126 * data[i] + 0.7152 * data[i + 1] + 0.0722 * data[i + 2];
          sum += y; sumSq += y * y;
        }
        const mean = sum / n;
        const variance = sumSq / n - mean * mean;
        return { mean, variance };
      }

      function saveCalibration(c) {
        try { localStorage.setItem('pokerScannerCalibration', JSON.stringify(c)); } catch {}
      }
      function loadCalibration() {
        try {
          const raw = localStorage.getItem('pokerScannerCalibration');
          return raw ? JSON.parse(raw) : null;
        } catch { return null; }
      }

      startB.addEventListener('click', startCamera);
      stopB .addEventListener('click', stopCamera);
      calB  .addEventListener('click', calibrate);
      resB  .addEventListener('click', showResult);
      advB  .addEventListener('click', showAdvice);

      video.addEventListener('loadeddata', () => { status.textContent = 'Camera actief.'; });
      startCamera();
    })();
  </script>
</section>
<!-- === /Pokerhand Scanner === -->
