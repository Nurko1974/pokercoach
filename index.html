<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Poker Coach</title>
  <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="/manifest.webmanifest">
  <meta name="theme-color" content="#0b0b0b">
  <link rel="apple-touch-icon" href="/icon-192.png">
  <script type="module" crossorigin src="/assets/index-DFygKoBP.js"></script>
</head>
<body>
  <h1>Poker Coach</h1>

  <div class="input">
    <label>Jouw hand:</label>
    <input id="hand" placeholder="Bijv. AhKh (h = hearts)" />
  </div>

  <div class="input">
    <label>Board (optioneel):</label>
    <input id="board" placeholder="Bijv. QhJh9d" />
  </div>

  <div class="input">
    <label>Pot (â‚¬):</label>
    <input id="pot" type="number" value="10" />
  </div>

  <div class="input">
    <label>Bet van tegenstander (â‚¬):</label>
    <input id="bet" type="number" value="5" />
  </div>
  
<div class="input">
  <label>Tegenstander type (range):</label>
  <select id="villainType">
    <option value="tight">Tight</option>
    <option value="average" selected>Average</option>
    <option value="loose">Loose</option>
  </select>
</div>

<div class="input">
  <label>Aantal tegenstanders:</label>
  <input id="numOpp" type="number" value="1" min="1" max="6" />
</div>
<div class="input">
  <label>Jouw positie (preflop):</label>
  <select id="heroPos">
    <option>UTG</option>
    <option>HJ</option>
    <option>CO</option>
    <option selected>BTN</option>
    <option>SB</option>
    <option>BB</option>
  </select>
</div>
<div class="input">
  <label>Simulatiesnelheid:</label>
  <select id="simSpeed">
    <option value="5000">Snel (5k)</option>
    <option value="20000" selected>Normaal (20k)</option>
    <option value="50000">Nauwkeurig (50k)</option>
  </select>
</div>

<div class="input">
  <label>Villain positie (preflop):</label>
  <select id="villainPos">
    <option>UTG</option>
    <option>HJ</option>
    <option>CO</option>
    <option>BTN</option>
    <option selected>SB</option>
    <option>BB</option>
  </select>
</div>

<div class="input">
  <label>Situatie:</label>
  <select id="spot">
    <option value="first_in" selected>First-in (open)</option>
    <option value="vs_open">Vs open raise</option>
    <option value="vs_3bet">Vs 3-bet</option>
  </select>
</div>

<div class="input">
  <label>Postflop: ik ben in positie (IP)</label>
  <input id="ipFlag" type="checkbox" checked />
</div>

<hr>
<h2>ðŸ“· Scanner</h2>
 <!-- === Pokerhand Scanner (groot + start/stop + kalibreer/scan) === -->
<section id="poker-scanner" style="padding:16px; text-align:center;">
  <h2 style="margin-bottom:12px;">Pokerhand Scanner</h2>

  <!-- Grote, responsieve camera -->
  <video id="camera" autoplay playsinline muted
         style="
           width:min(100%, 960px);
           aspect-ratio:16/9;
           height:auto;
           background:#000;
           border:1px solid #222;
           border-radius:12px;
           display:block;
           margin:0 auto;
         ">
  </video>

  <!-- Verborgen canvas voor snapshots/analyse -->
  <canvas id="scannerCanvas" style="display:none;"></canvas>

  <!-- Knoppen -->
  <div style="margin-top:14px; display:flex; gap:10px; flex-wrap:wrap; justify-content:center;">
    <button id="startBtn">Start camera</button>
    <button id="stopBtn">Stop camera</button>
    <button id="calibrateBtn">Kalibreren</button>
    <button id="resultBtn">Scanresultaat</button>
  </div>

  <!-- Status + Resultaat -->
  <p id="scannerStatus" style="margin-top:10px; color:#666;">Gereedâ€¦</p>
  <div id="scanResult" style="margin:8px auto 0; max-width:960px; text-align:left;"></div>

  <script>
    (function () {
      // Elements
      const video  = document.getElementById('camera'); // zelfde id als eerder
      const canvas = document.getElementById('scannerCanvas');
      const status = document.getElementById('scannerStatus');
      const out    = document.getElementById('scanResult');

      const btnStart = document.getElementById('startBtn');
      const btnStop  = document.getElementById('stopBtn');
      const btnCal   = document.getElementById('calibrateBtn');
      const btnRes   = document.getElementById('resultBtn');

      let stream = null;
      let calibration = loadCalibration();

      // Start camera (groot, zelfde gedrag)
      async function startCamera() {
        if (video.srcObject && video.srcObject.active) {
          status.textContent = 'Camera is al actief.';
          return;
        }
        try {
          const constraints = {
            video: { facingMode: { ideal: 'environment' } },
            audio: false
          };
          stream = await navigator.mediaDevices.getUserMedia(constraints);
          video.srcObject = stream;
          status.textContent = 'Camera actief en klaar voor gebruik.';
        } catch (err) {
          status.textContent = 'Camera niet beschikbaar: ' + err.message;
        }
      }

      // Stop camera netjes
      function stopCamera() {
        const s = video.srcObject;
        if (s && s.getTracks) {
          s.getTracks().forEach(t => t.stop());
        }
        video.srcObject = null;
        stream = null;
        status.textContent = 'Camera gestopt.';
      }

      // Kalibreren (basis-metrics opslaan)
      function calibrate() {
        if (!videoReady()) {
          status.textContent = 'Start eerst de camera.';
          return;
        }
        const m = snapshotMetrics();
        calibration = { mean: m.mean, variance: m.variance, ts: Date.now() };
        saveCalibration(calibration);
        status.textContent = 'Kalibratie voltooid âœ… (mean=' + calibration.mean.toFixed(1) + ')';
      }

      // Scanresultaat (voorbeeld; koppel hier je eigen logica)
      function showResult() {
        if (!videoReady()) {
          status.textContent = 'Start eerst de camera.';
          return;
        }
        const m = snapshotMetrics();
        let compare = 'Geen kalibratie gevonden (tip: eerst Kalibreren).';
        if (calibration) {
          const dMean = Math.abs(m.mean - calibration.mean);
          const dVar  = Math.abs(m.variance - calibration.variance);
          compare = `Î” helderheid: ${dMean.toFixed(1)}, Î” ruis: ${dVar.toFixed(1)}`;
        }
        out.innerHTML = `
          <div style="padding:12px; border:1px solid #e5e5e5; border-radius:10px;">
            <div style="font-weight:600; margin-bottom:6px;">Scanresultaat</div>
            <div><strong>Gem. helderheid:</strong> ${m.mean.toFixed(1)}</div>
            <div><strong>Variantie (ruis):</strong> ${m.variance.toFixed(1)}</div>
            <div style="margin-top:6px;"><strong>Vergelijking t.o.v. kalibratie:</strong> ${compare}</div>
          </div>
        `;
        status.textContent = 'Scan voltooid âœ…';
      }

      // Helpers
      function videoReady() {
        return video && video.readyState >= 2 && (video.videoWidth || 0) > 0;
      }

      function snapshotMetrics() {
        const w = video.videoWidth || 1280;
        const h = video.videoHeight || Math.round(w * 9 / 16);
        if (canvas.width !== w) canvas.width = w;
        if (canvas.height !== h) canvas.height = h;

        const ctx = canvas.getContext('2d', { willReadFrequently: true });
        ctx.drawImage(video, 0, 0, w, h);
        const { data } = ctx.getImageData(0, 0, w, h);

        let sum = 0, sumSq = 0, n = data.length / 4;
        for (let i = 0; i < data.length; i += 4) {
          const y = 0.2126 * data[i] + 0.7152 * data[i + 1] + 0.0722 * data[i + 2]; // luma
          sum += y; sumSq += y * y;
        }
        const mean = sum / n;
        const variance = sumSq / n - mean * mean;
        return { mean, variance };
      }

      function saveCalibration(c) {
        try { localStorage.setItem('pokerScannerCalibration', JSON.stringify(c)); } catch {}
      }
      function loadCalibration() {
        try {
          const raw = localStorage.getItem('pokerScannerCalibration');
          return raw ? JSON.parse(raw) : null;
        } catch { return null; }
      }

      // Events
      btnStart.addEventListener('click', startCamera);
      btnStop .addEventListener('click', stopCamera);
      btnCal  .addEventListener('click', calibrate);
      btnRes  .addEventListener('click', showResult);
      video.addEventListener('loadeddata', () => { status.textContent = 'Camera actief.'; });

      // Optioneel: start direct als je dat gewend was
      startCamera();
    })();
  </script>
</section>
<!-- === /Pokerhand Scanner === -->
